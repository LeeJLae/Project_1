from ultralytics import YOLO
import os

# YOLO 모델 로드
model = YOLO('/home/jovyan/yolo11obb/yolo11m-obb.pt')

# 학습에 사용할 데이터셋 경로를 정의한 .yaml 파일 경로
train_data = '/home/jovyan/data-vol-1/Y_T_Data/new_obb.yaml'

# 학습 결과를 저장할 디렉토리 생성
output_dir = '/home/jovyan/data-vol-1/Result/TEST1_yolov11m'
os.makedirs(output_dir, exist_ok=True)

# 학습 실행 (검증 데이터 사용 안 함)
model.train(data=train_data, epochs=50, imgsz=640, batch=16, lr0=0.001, device='cuda', amp=False, val=False)

# 학습된 모델 저장
model.save(os.path.join(output_dir, 'TEST5_yolov11m.pt'))

# 테스트 이미지 경로 설정
test_image_dir = '/home/jovyan/data-vol-1/trashcan/test_image2'

# 모델 평가 함수
def test_model():
    # model.predict 사용하여 테스트 수행 및 결과 저장
    results = model.predict(
        source=test_image_dir,  # 테스트할 이미지 폴더 경로
        save=True,              # 결과 이미지를 저장
        project=output_dir,     # 저장할 기본 디렉토리
        name="test_results"     # 결과를 저장할 하위 폴더 이름
    )
    print(f"Test results saved to: {os.path.join(output_dir, 'test_results')}")

# 테스트 실행
test_model()
