def test_model():
    results_folder = os.path.join(output_dir, '1STEP_YOLO_result')
    os.makedirs(results_folder, exist_ok=True)  # 결과 폴더가 없으면 생성
    
    results = model.predict(
        source=test_image_folder,  # 테스트할 이미지 폴더 경로
        save=True,                 # 결과 이미지를 저장
        project=output_dir,        # 저장할 기본 디렉토리
        name="1STEP_YOLO_result"   # 결과를 저장할 하위 폴더 이름
    )
    print(f"Test results saved to: {results_folder}")
    
    # IoU 결과 저장할 파일 경로 설정
    iou_results_path = os.path.join(results_folder, 'iou_results.txt')
    with open(iou_results_path, 'w') as f:
        for result in results:
            image_name = os.path.basename(result.path)  # 이미지 이름
            ground_truths = load_ground_truth_boxes(label_folder, image_name)  # 정답 바운딩 박스 불러오기
            predictions = result.boxes.xyxy if result.boxes is not None else []  # 예측 바운딩 박스
            
            # IoU 계산 및 저장
            for gt_box, pred_box in zip(ground_truths, predictions):
                iou = calculate_iou(gt_box, pred_box.tolist())
                f.write(f"IoU for {result.path}: {iou:.4f}\n")
    
    print(f"IoU results saved to: {iou_results_path}")

# 테스트 실행
test_model()
